language: android

jdk: 
    - oraclejdk8

android:
  components:
    # Uncomment the lines below if you want to
    # use the latest revision of Android SDK Tools
    - tools
    - platform-tools

    # The BuildTools version used by your project
    - build-tools-23.0.1
    - build-tools-23.0.2
    - build-tools-23.0.3    
    - build-tools-24.0.2

    # The SDK version used to compile your project
    - android-23
    - android-24

    # Additional components
    - extra-google-m2repository
    - extra-android-m2repository

    # Specify at least one system image,
    # if you need to run emulator(s) during your tests
    - sys-img-armeabi-v7a-android-23
    - sys-img-x86-android-23

lein: ~/bin/lein

before_install:
  - nvm install node
  - npm update -g
  - node -v
  - npm -v 
  - mkdir ~/bin
  - wget https://raw.github.com/technomancy/leiningen/stable/bin/lein -P ~/bin/
  - chmod a+x ~/bin/lein

install:
  - lein deps
  - npm install
  - ./re-natal deps
  - lein generate-externs

before_script:
  - JAVA_OPTS="-Xms128m -Xmx512m" lein do with-profile prod cljsbuild once android

script:
  # cd android && ./gradlew assembleRelease --stacktrace
  - REACT_NATIVE_MAX_WORKERS=2 react-native run-android --variant=release 
